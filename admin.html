<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุชุญูู ุงููุฏุฑุณ</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="admin-theme">
    <!-- Login Modal -->
    <div id="loginOverlay" class="overlay">
        <div class="modal glass">
            <h2 style="margin-bottom: 1.5rem; text-align: center;">ุชุณุฌูู ุฏุฎูู ุงููุฏุฑุณ</h2>
            <div class="form-group">
                <label>ุงุณู ุงููุณุชุฎุฏู</label>
                <input type="text" id="adminUser" value="0">
            </div>
            <div class="form-group">
                <label>ูููุฉ ุงููุฑูุฑ</label>
                <input type="password" id="adminPass" value="0">
            </div>
            <button onclick="adminLogin()">ุฏุฎูู</button>
            <p id="loginError" style="color: #ef4444; font-size: 0.8rem; margin-top: 0.5rem; display: none;">ุจูุงูุงุช ุฏุฎูู
                ุฎุงุทุฆุฉ!</p>
        </div>
    </div>

    <!-- Dashboard Layout -->
    <div id="adminContent" class="dashboard-wrapper" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-logo">ููุญุฉ ุฅุฏุงุฑุฉ ุงูุฏุฑูุณ</div>
            <div class="nav-item active" onclick="showSection('stats')">๐ ุงูุฅุญุตุงุฆูุงุช</div>
            <div class="nav-item" onclick="showSection('lessons')">๐ ุฅุฏุงุฑุฉ ุงูุฏุฑูุณ</div>
            <div class="nav-item" onclick="showSection('codes')">๐ ุฃููุงุฏ ุงูุทูุงุจ</div>
            <div style="margin-top: auto;">
                <a href="index.html" class="nav-item" style="background: rgba(255,255,255,0.05);">๐๏ธ ุนุฑุถ ุงูููุตุฉ</a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Stats Section -->
            <div id="statsSection">
                <h1 style="margin-bottom: 2rem;">ูุฑุญุจุงู ุจูุ ุฃููุง ุงููุนูู</h1>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">ุฅุฌูุงูู ุงูููุฏูููุงุช</div>
                        <div id="statVideos" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ุงูุฃููุงุฏ ุงูููุชุฌุฉ</div>
                        <div id="statCodes" class="stat-value">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">ุฃููุงุฏ ูุณุชุฎุฏูุฉ</div>
                        <div id="statUsedCodes" class="stat-value" style="color: #6366f1;">0</div>
                    </div>
                </div>
            </div>

            <!-- Lessons Section -->
            <div id="lessonsSection" style="display: none;">
                <div class="glass" style="padding: 2rem; margin-bottom: 2rem;">
                    <h2>ุฅุถุงูุฉ ุฏุฑุณ ุฌุฏูุฏ</h2>
                    <div
                        style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; margin-top: 1rem; align-items: end;">
                        <div class="form-group" style="margin:0">
                            <label>ุงุณู ุงูุฏุฑุณ</label>
                            <input type="text" id="lessonTitle" placeholder="ูุซุงู: ุงูุฏุฑุณ ุงูุฃูู">
                        </div>
                        <div class="form-group" style="margin:0">
                            <label>ุฑุงุจุท ุงูููุฏูู</label>
                            <input type="text" id="lessonUrl" placeholder="YouTube ุฃู Drive">
                        </div>
                        <button onclick="handleAddVideo()" style="width: auto; padding: 0.8rem 2rem;">ุญูุธ</button>
                    </div>
                </div>

                <div class="glass" style="padding: 1rem;">
                    <h3>ุงูุฏุฑูุณ ุงูุญุงููุฉ</h3>
                    <div id="lessonsList" style="margin-top: 1rem;"></div>
                </div>
            </div>

            <!-- Codes Section -->
            <div id="codesSection" style="display: none;">
                <div class="glass" style="padding: 2rem; margin-bottom: 2rem;">
                    <h2>ุชูููุฏ ุฃููุงุฏ ุฌุฏูุฏุฉ</h2>
                    <div
                        style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; margin-top: 1rem; align-items: end;">
                        <div class="form-group" style="margin:0">
                            <label>ุงุฎุชุฑ ุงูุฏุฑุณ</label>
                            <select id="codeVideoSelect"></select>
                        </div>
                        <button onclick="handleGenerateCode()" style="width: auto; padding: 0.8rem 2rem;">ุฅูุดุงุก ููุฏ (15
                            ุญุฑู)</button>
                    </div>
                </div>

                <div class="glass" style="padding: 1rem;">
                    <h3>ุณุฌู ุงูุฃููุงุฏ</h3>
                    <div style="overflow-x: auto; margin-top: 1rem;">
                        <table style="width: 100%; text-align: right;">
                            <thead>
                                <tr>
                                    <th style="padding: 1rem;">ุงูููุฏ</th>
                                    <th style="padding: 1rem;">ุงูุฏุฑุณ</th>
                                    <th style="padding: 1rem;">ุงูุญุงูุฉ</th>
                                    <th style="padding: 1rem;">ุงูุฌูุงุฒ</th>
                                    <th style="padding: 1rem;">ุงูุตูุงุญูุฉ</th>
                                </tr>
                            </thead>
                            <tbody id="codesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function adminLogin() {
            const user = document.getElementById('adminUser').value;
            const pass = document.getElementById('adminPass').value;
            if (user === '0' && pass === '0') {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminContent').style.display = 'flex';
                refreshAdminData();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function showSection(sectionId) {
            // Hide all
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('lessonsSection').style.display = 'none';
            document.getElementById('codesSection').style.display = 'none';

            // Remove active from nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

            // Show target
            document.getElementById(sectionId + 'Section').style.display = 'block';
            event.currentTarget.classList.add('active');
            refreshAdminData();
        }

        function refreshAdminData() {
            const videos = getVideos();
            const codes = getCodes();

            // Update Stats
            document.getElementById('statVideos').innerText = videos.length;
            document.getElementById('statCodes').innerText = codes.length;
            document.getElementById('statUsedCodes').innerText = codes.filter(c => c.status === 'used').length;

            loadAdminLessons();
            loadVideoSelect();
            loadCodesTable();
        }

        function handleAddVideo() {
            const title = document.getElementById('lessonTitle').value;
            const url = document.getElementById('lessonUrl').value;
            if (title && url) {
                saveVideo(title, url);
                document.getElementById('lessonTitle').value = '';
                document.getElementById('lessonUrl').value = '';
                refreshAdminData();
            }
        }

        function loadAdminLessons() {
            const list = document.getElementById('lessonsList');
            const videos = getVideos();
            list.innerHTML = videos.map(v => `
                <div class="admin-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #eee;">
                    <span style="font-weight: 600;">${v.title}</span>
                    <button class="delete-btn" onclick="removeVideo(${v.id})" style="background:#ef4444; width:auto; padding: 0.4rem 1rem; font-size: 0.8rem;">ุญุฐู</button>
                </div>
            `).join('');
        }

        function loadVideoSelect() {
            const select = document.getElementById('codeVideoSelect');
            const videos = getVideos();
            select.innerHTML = videos.map(v => `<option value="${v.id}">${v.title}</option>`).join('');
        }

        function handleGenerateCode() {
            const videoId = document.getElementById('codeVideoSelect').value;
            if (!videoId) return alert('ุฃุถู ุฏุฑุณุงู ุฃููุงู');
            const codes = getCodes();
            codes.push({
                code: generateRandomCode(),
                videoId: videoId,
                status: 'unused',
                firstDevice: null,
                expiryDate: null
            });
            saveCodes(codes);
            refreshAdminData();
        }

        function loadCodesTable() {
            const body = document.getElementById('codesTableBody');
            const codes = getCodes();
            const videos = getVideos();
            body.innerHTML = codes.slice().reverse().map(c => {
                const video = videos.find(v => v.id == c.videoId);
                const expiryText = c.expiryDate ? new Date(c.expiryDate).toLocaleDateString('ar-EG', { day: 'numeric', month: 'short' }) : '-';
                return `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 1rem;"><code>${c.code}</code></td>
                        <td style="padding: 1rem;">${video ? video.title : 'ูุญุฐูู'}</td>
                        <td style="padding: 1rem; color: ${c.status === 'used' ? '#ef4444' : '#10b981'}">${c.status === 'used' ? 'ูุณุชุฎุฏู' : 'ูุชุงุญ'}</td>
                        <td style="padding: 1rem; font-size: 0.7rem; color: #64748b;">${c.firstDevice || '-'}</td>
                        <td style="padding: 1rem;">${expiryText}</td>
                    </tr>
                `;
            }).join('');
        }

        function removeVideo(id) {
            if (confirm('ุชุฃููุฏ ุงูุญุฐูุ')) {
                deleteVideo(id);
                refreshAdminData();
            }
        }
    </script>
</body>

</html>

</html>

</html>